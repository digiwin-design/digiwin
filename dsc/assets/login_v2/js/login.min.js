"use strict";axios.get("/tw/dsc/assets/login_v2/subscribe.json").then(function(e){new Vue({el:".list-case-show",components:{"subscribe-form":httpVueLoader("./components/subscribe-form.vue"),"login-form":httpVueLoader("./components/login-form.vue")},data:{showPopup:!1},computed:{dev:function(){return"localhost"===location.hostname},userId:function(){return localStorage.getItem("lineUserId")},channelID:function(){return"1570741188"},channelSecret:function(){return"8082e9d4b345e1b3768f160ddd76a6ee"},state:function(){return"abcde"},callbackUrl:function(){return location.origin+location.pathname}},methods:{checkLogin:function(){var e=new Date,t=parseInt(localStorage.getItem("lineExp"),10);return t&&!(e.getTime()>t)||(this.cleanLS(),!1)},getCode:function(){var e=this.getParameterByName("code"),t=this.getParameterByName("state");if(e&&t===this.state){var o=this.callbackUrl.split("/").pop();return history.replaceState({},"",o),void this.getToken(e)}this.showCover()},getToken:function(e){var t=this,o=new URLSearchParams;o.append("grant_type","authorization_code"),o.append("code",e),o.append("redirect_uri",this.callbackUrl),o.append("client_id",this.channelID),o.append("client_secret",this.channelSecret),axios.post("https://api.line.me/oauth2/v2.1/token",o).then(function(e){return 200===e.status?(t.accessToken=e.data.access_token,localStorage.setItem("lineToken",t.accessToken),void t.getProfile(t.accessToken)):t.showCover()}).catch(function(){return t.showCover()})},getProfile:function(e){var n=this;axios.get("https://api.line.me/v2/profile",{headers:{Authorization:"Bearer ".concat(e)}}).then(function(e){if(200!==e.status)return n.showCover();localStorage.setItem("lineUserId",e.data.userId),localStorage.setItem("lineDisplayName",e.data.displayName);var t=new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate()+3);localStorage.setItem("lineExp",o.getTime()),n.dev||n.saveData()}).catch(function(){return n.showCover()})},saveData:function(){var t={lineId:this.userId,source:location.href},e=new URLSearchParams;e.append("",JSON.stringify(t)),axios.post("https://misws.digiwin.com/SocialMediaMarketing/api/loglist/Save",e).then(function(e){console.log(t),e.data&&e.data.result||console.error(e.data.msg)})},showCover:function(){1400<this.$el.offsetHeight&&(this.$el.style.height="1400px",this.$el.style.overflow="hidden"),this.$el.classList.add("no-login")},addCover:function(){document.querySelector(".list-case-show").insertAdjacentHTML("beforeend",'<div class="articleCover"><a href @click.prevent="showPopup=true">全文閱讀</a></div><login-form v-model="showPopup" :info="{ channelID: channelID, state: state, callbackUrl: callbackUrl }"></login-form>'),this.dev&&document.querySelector(".list-case-show").insertAdjacentHTML("beforeend",'<button @click="logout" style="position: fixed;left: 0;bottom: 0;z-index: 1;">登出</button>')},addSubscribeForm:function(e){var a=location.pathname.replace(/(.html|.htm)$/,"");e.forEach(function(e){var t=e.url,o=e.title,n=e.lineUrl;(t=t.replace(/(.html|.htm)$/,""))===a&&document.querySelector(".list-case-show").insertAdjacentHTML("beforeend",'<subscribe-form title="'.concat(o,'" line-url="').concat(n,'"></subscribe-form>'))})},logout:function(){this.cleanLS(),location.reload()},cleanLS:function(){localStorage.removeItem("lineToken"),localStorage.removeItem("lineUserId"),localStorage.removeItem("lineDisplayName"),localStorage.removeItem("lineExp")},getParameterByName:function(e){return new URL(location.href).searchParams.get(e)}},created:function(){this.addCover(),this.addSubscribeForm(e.data)},mounted:function(){this.checkLogin()||this.getCode()}})});
//# sourceMappingURL=login.min.js.map
