"use strict";httpVueLoader.register(Vue,"/tw/dsc/assets/lineMember/components/SubscribeForm.vue"),new Vue({el:".list-case-show",computed:{userId:function(){return localStorage.getItem("lineUserId")},channelID:function(){return"1570741188"},channelSecret:function(){return"8082e9d4b345e1b3768f160ddd76a6ee"},state:function(){return"abcde"},callbackUrl:function(){return location.origin+location.pathname},formMap:function(){return{"/tw/dsc/dev/demo/line_member":"工業 3.5 專題訂閱"}}},methods:{getParameterByName:function(e){var t=new URL(location.href),a=t.searchParams,o=!0,n=!1,i=void 0;try{for(var r,s,c=a[Symbol.iterator]();!(o=(r=c.next()).done);o=!0)if(s=r.value,s[0]===e)return s[1]}catch(e){n=!0,i=e}finally{try{!o&&c["return"]&&c["return"]()}finally{if(n)throw i}}},cleanLS:function(){localStorage.removeItem("lineToken"),localStorage.removeItem("lineUserId"),localStorage.removeItem("lineDisplayName"),localStorage.removeItem("lineExp")},login:function(){var e="https://access.line.me/oauth2/v2.1/authorize?";e+="response_type=code",e+="&client_id="+this.channelID,e+="&redirect_uri="+this.callbackUrl,e+="&state="+this.state,e+="&scope=openid%20email%20profile",location.href=e},logout:function(){this.cleanLS(),location.reload()},checkLogin:function(){var e=new Date,t=parseInt(localStorage.getItem("lineExp"),10);return t&&!(e.getTime()>t)||(this.cleanLS(),!1)},getCode:function(){var e=this.getParameterByName("code"),t=this.getParameterByName("state");if(e&&t===this.state){var a=this.callbackUrl.split("/").pop();return history.replaceState({},"",a),void this.getToken(e)}this.showCover()},getToken:function(e){var t=this,a=new URLSearchParams;a.append("grant_type","authorization_code"),a.append("code",e),a.append("redirect_uri",this.callbackUrl),a.append("client_id",this.channelID),a.append("client_secret",this.channelSecret),axios.post("https://api.line.me/oauth2/v2.1/token",a).then(function(e){return 200===e.status?(t.accessToken=e.data.access_token,localStorage.setItem("lineToken",t.accessToken),void t.getProfile(t.accessToken)):t.showCover()})["catch"](function(){return t.showCover()})},getProfile:function(e){var t=this;axios.get("https://api.line.me/v2/profile",{headers:{Authorization:"Bearer "+e}}).then(function(e){if(200!==e.status)return t.showCover();localStorage.setItem("lineUserId",e.data.userId),localStorage.setItem("lineDisplayName",e.data.displayName);var a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate()+3);localStorage.setItem("lineExp",o.getTime()),t.saveData()})["catch"](function(){return t.showCover()})},showCover:function(){1400<this.$el.offsetHeight&&(this.$el.style.height="1400px",this.$el.style.overflow="hidden"),this.$el.classList.add("no-login")},addForm:function(){var e=location.pathname.replace(/(.html|.htm)$/,"");for(var t in this.formMap)if(this.formMap.hasOwnProperty(t)){var a=t.replace(/(.html|.htm)$/,"");if(a===e){var o=this.formMap[t];$(".list-case-show").append('<subscribe-form title="'+o+'"></subscribe-form>')}}},addCover:function(){$(".list-case-show").append('<div class="articleCover"><a href @click.prevent="login">登入看更多</a></div>'),$(".list-case-show").prepend('<button @click="logout" style="position: fixed;left: 0;bottom: 0;z-index: 1;">登出</button>')},saveData:function(){var e={lineId:this.userId,source:location.href},t=new URLSearchParams;t.append("",JSON.stringify(e)),axios.post("https://misws.digiwin.com/SocialMediaMarketing/api/loglist/Save",t).then(function(e){e.data&&e.data.result||console.error(e.data.msg)})}},created:function(){this.addForm(),this.addCover()},mounted:function(){this.checkLogin()||this.getCode()}});
//# sourceMappingURL=lineMember.min.js.map
