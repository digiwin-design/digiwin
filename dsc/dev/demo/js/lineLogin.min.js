"use strict";new Vue({el:"#app",data:{loading:!1,displayName:"",pictureUrl:"",accessToken:""},computed:{redirectUri:function(){return"https://www.digiwin.com/tw/dsc/dev/line_login/index"}},methods:{getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=i.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},checkToken:function(){return this.accessToken=localStorage.getItem("lineToken")},login:function(){var e="https://access.line.me/oauth2/v2.1/authorize?";e+="response_type=code",e+="&client_id=1563584152",e+="&redirect_uri="+this.redirectUri,e+="&state=abcde",e+="&scope=openid%20email%20profile",location.href=e},logout:function(){localStorage.removeItem("lineToken"),location.href=this.redirectUri},getCode:function(){var e=this.getParameterByName("code",location.href),t=this.getParameterByName("state",location.href);e&&"abcde"===t&&(history.replaceState({},"","index"),this.getToken(e))},getToken:function(e){var t=this;this.loading=!0;var i=new URLSearchParams;i.append("grant_type","authorization_code"),i.append("code",e),i.append("redirect_uri",this.redirectUri),i.append("client_id","1563584152"),i.append("client_secret","784af891734ae5e34c4b8ea5c382410c"),axios.post("https://api.line.me/oauth2/v2.1/token",i).then(function(e){200===e.status&&(t.accessToken=e.data.access_token,localStorage.setItem("lineToken",t.accessToken),t.getProfile(t.accessToken))})},getProfile:function(e){var t=this;this.loading=!0,axios.get("https://api.line.me/v2/profile",{headers:{Authorization:"Bearer "+e}}).then(function(e){200===e.status&&(t.displayName=e.data.displayName,t.pictureUrl=e.data.pictureUrl,t.loading=!1)})}},mounted:function(){var e=this.checkToken();e?this.getProfile(e):this.getCode()},beforeDestroy:function(){this.logout()},template:'\n        <div v-if="!loading">\n            <template v-if="displayName && pictureUrl">\n                <h1>Hi~ {{displayName}}</h1>\n                <img :src="pictureUrl" class="picture" alt="">\n            </template>\n            <a href v-else @click.prevent="login">\n                <img src="images/lineLogin/loginBtn.png" class="loginBtn" alt="">\n            </a>\n            <button v-if="accessToken" @click="logout">登出</button>\n        </div>\n    '});
//# sourceMappingURL=lineLogin.min.js.map
